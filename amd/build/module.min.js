define("block_quizonepagepaginate/module", ["exports"], (function (_exports) {
    Object.defineProperty(_exports, "__esModule", { value: !0 }), _exports.init = void 0;
    /**
       * JS for this plugin.
       *
       * @copyright   IntegrityAdvocate.com
       * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
       */

class block_quizonepagepaginate{constructor(e,t){const o=this,n=o.constructor.name+".constructor";if(window.console.log(n+"::Started with versionstring="+e+"; questionsperpage="+t),o.isAQuizAttemptPage()){if(isNaN(t))throw new Error(n+"::Invalid value passed for param questionsperpage");if(o.questionsperpage=parseInt(t),o.questionsperpage<1)throw new Error(n+"::Invalid value passed for param questionsperpage");o.firstQuestionToShow=0,o.eltQuestionsSelector="#page-mod-quiz-attempt #responseform .que",o.eltQuizFinishAttemptButtonSelector="#responseform .submitbtns .mod_quiz-next-nav",o.eltBqoppButtonPrev=o.constructor.name+"-prev",o.eltBqoppButtonNext=o.constructor.name+"-next",o.arrQuestions=[]}}run(){const e=this,t=e.constructor.name+".run";if(!e.isAQuizAttemptPage()||!e.shouldQuizPaginate())return void window.console.log(t+"::We should not use this block JS: self.isAQuizAttemptPage()="+e.isAQuizAttemptPage()+"; self.shouldQuizPaginate()="+e.shouldQuizPaginate());e.getAllQuestions(),e.addNextPrevButtons(),window.addEventListener("hashchange",e.handleAnchorChange);const o=e.getAnchorQuestionIndex(document.URL);o>=0&&(e.firstQuestionToShow=o),e.hideShowQuestions(e.firstQuestionToShow,e.questionsperpage)}isAQuizAttemptPage(){return"page-mod-quiz-attempt"===document.body.id}shouldQuizPaginate(){const e=this;e.constructor.name;let t=!1;return e.getAllQuestions(),t=e.questionsperpage<e.arrQuestions.length,t}getAnchorQuestionIndex(e=""){const t=this;t.constructor.name;let o=-1;const n=t.getAnchor(e);if(!n||n.length<12)return o;const s=t.getAnchorQuestionNr(n);return s?(o=t.findQuestionIndexFromQuestionNr(s),o):o}getAnchor(e=""){if(!e||e.length<1||"string"!=typeof e)return"";let t=e.split("#")[1];return t||""}getAnchorQuestionNr(e=""){this.constructor.name;let t="";if(e&&e.length>2){const o=e.match(/(question-\d+-\d+)/);o&&(t=o[1])}return t}findQuestionIndexFromQuestionNr(e=""){const t=this,o=t.constructor.name+".findQuestionIndexFromQuestionNr";let n=-1;return!e||"string"!=typeof e||e.length<12?(window.console.log(o+"::Invalid value passed for questionNr so return not found"),n):t.arrQuestions.length<1?(window.console.log(o+"::arrQuestions is empty so return not found"),n):(t.arrQuestions.forEach(((t,o)=>{t.id!==e||(n=o)})),n)}getAllQuestions(){const e=this;e.constructor.name;return void 0!==e.arrQuestions&&e.arrQuestions.length>0||(e.arrQuestions=document.querySelectorAll(e.eltQuestionsSelector)),e.arrQuestions}hideShowQuestions(e=0,t){const o=M.block_quizonepagepaginate,n=o.constructor.name+".hideShowQuestions";if(isNaN(e)||isNaN(t)||e<0||t<1)throw new Error(n+"::Invalid value passed for param first or length");if(o.arrQuestions.length<1)throw new Error(n+"::self.arrQuestions is empty");const s=e+t;let r=0;o.arrQuestions.forEach(((t,n)=>{n>=e&&n<s&&r<o.questionsperpage?(t.classList.remove("quizonepage-hidden"),r++):t.classList.add("quizonepage-hidden")})),o.updatePrevNextButtonVisibility()}scrollToQuestion(){document.querySelector("#responseform").scrollIntoView({behavior:"smooth"})}addNextPrevButtons(){const e=this,t=e.constructor.name+".addNextPrevButtons",o=document.querySelector(e.eltQuizFinishAttemptButtonSelector);if(null===o)throw new Error(t+"::No button found to clone");const n=[{key:"previous",component:"core"},{key:"next",component:"core"}];require(["core/str"],(function(s){s.get_strings(n).then((function(t){e.addPrevNextButton(o,"prev",t).addEventListener("click",e.buttonClickedPrev);return e.addPrevNextButton(o,"next",t).addEventListener("click",e.buttonClickedNext),t})).catch((function(e){throw console.error(t+"::Failed to get strings",e),e}))}))}addPrevNextButton(e,t,o){const n=M.block_quizonepagepaginate,s=n.constructor.name+".addPrevNextButton";if(!(e instanceof Element))throw new Error(s+"::Invalid value passed for param eltCloneSource");if("prev"!==t&&"next"!==t)throw new Error(s+"::Invalid value passed for param nextorprev");if(!Array.isArray(o)||o.length<2)throw new Error(s+"::Invalid value passed for param strings");const r=e.cloneNode(),i="prev"===t,u=i?n.eltBqoppButtonPrev:n.eltBqoppButtonNext,a=o[i?0:1];return r.setAttribute("id",u),r.className=r.className.replace("btn-primary","btn-secondary"),r.name=u,r.value=a,r.setAttribute("data-initial-value",a),r.removeAttribute("disabled"),n.updatePrevNextButtonVisibility(),e.parentNode.insertBefore(r,e)}updatePrevNextButtonVisibility(){const e=M.block_quizonepagepaginate,t=(e.constructor.name,document.getElementById(e.eltBqoppButtonPrev)),o=document.getElementById(e.eltBqoppButtonNext);if(t&&(e.firstQuestionToShow<=0?(t.setAttribute("disabled","disabled"),t.classList.add("disabled")):(t.removeAttribute("disabled"),t.classList.remove("disabled"))),o){const t=e.arrQuestions.length-e.questionsperpage;e.firstQuestionToShow>=t?(o.setAttribute("disabled","disabled"),o.classList.add("disabled")):(o.removeAttribute("disabled"),o.classList.remove("disabled"))}}buttonClickedPrev(){const e=M.block_quizonepagepaginate;e.constructor.name;e.triggerAutosave(),e.updateVisibleQuestionRange(!1),e.hideShowQuestions(e.firstQuestionToShow,e.questionsperpage),e.scrollToQuestion(),e.updatePrevNextButtonVisibility()}buttonClickedNext(){const e=M.block_quizonepagepaginate;e.constructor.name;e.triggerAutosave(),e.updateVisibleQuestionRange(!0),e.hideShowQuestions(e.firstQuestionToShow,e.questionsperpage),e.scrollToQuestion(),e.updatePrevNextButtonVisibility()}triggerAutosave(){const e=M.block_quizonepagepaginate.constructor.name+".triggerAutosave";try{M.mod_quiz.autosave.save_changes()}catch(t){window.console.log(e+"::autosave is disabled")}}updateVisibleQuestionRange(e=!0){const t=M.block_quizonepagepaginate,o=t.constructor.name+".updateVisibleQuestionRange",n=t.questionsperpage,s=t.arrQuestions.length;if(e){const e=t.firstQuestionToShow+n;t.firstQuestionToShow=e+n<s?e:s-n}else{const e=t.firstQuestionToShow-n;window.console.log(o+"::Proposed start of the next set of questions=",e),t.firstQuestionToShow=e<0?0:e}}handleAnchorChange(e){const t=M.block_quizonepagepaginate,o=(t.constructor.name,e.target||e.srcElement);let n="";if(t.isWindowObj(o)&&(n=window.location.href),n.length<1){if(!o.closest("#mod_quiz_navblock"))return;const e=o.closest("a.qnbutton");if(!e)return;n=e.href}if(n.length<1)return;const s=t.getAnchorQuestionIndex(n);s>=0&&(t.firstQuestionToShow=s),t.hideShowQuestions(t.firstQuestionToShow,t.questionsperpage)}isWindowObj(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}}
_exports.init = (questionsperpage,versionstring) => {const e="block_quizonepagepaginate::init";!1&&window.console.log(e+"::Started with questionsperpage="+questionsperpage+'; versionstring='+versionstring);try{M.block_quizonepagepaginate=new block_quizonepagepaginate(versionstring, questionsperpage),M.block_quizonepagepaginate.run()}catch(e){window.console.error(e)}}
}));

//# sourceMappingURL=module.min.js.map